# Admin Club Approval & Manager Member Management - Complete Guide

## ðŸŽ¯ What You're Building

### Part 1: Admin Features

- Approve/Reject clubs (change club status)
- View all clubs with pending status

### Part 2: Manager Features

- View club members
- Change member status (active/expired)
- Set membership expiry date

---

## ðŸ“‚ PART 1: BACKEND CODE

### Step 1: Open Your `index.js` Backend File

Add these routes where your other admin/club routes are.

---

## ðŸ” ADMIN - Club Approval/Rejection APIs

```javascript
//!=============ADMIN CLUB APPROVAL START===========!//

//* 1. Get all clubs (Admin only - see all statuses)
app.get("/admin/clubs", verifyJWT, async (req, res) => {
  try {
    const adminEmail = req.tokenEmail;

    // Verify user is admin
    const user = await usersCollection.findOne({ email: adminEmail });

    if (!user || user.role !== "admin") {
      return res.status(403).json({
        success: false,
        message: "Access denied. Admin only.",
      });
    }

    // Get all clubs with all statuses
    const allClubs = await clubsCollection.find({}).toArray();

    // Count by status
    const pending = allClubs.filter((c) => c.status === "pending").length;
    const approved = allClubs.filter((c) => c.status === "approved").length;
    const rejected = allClubs.filter((c) => c.status === "rejected").length;

    res.json({
      success: true,
      total: allClubs.length,
      stats: { pending, approved, rejected },
      clubs: allClubs,
    });
  } catch (error) {
    console.error("Get admin clubs error:", error);
    res.status(500).json({
      success: false,
      message: "Failed to fetch clubs",
    });
  }
});

//* 2. Get only PENDING clubs (for approval queue)
app.get("/admin/clubs/pending", verifyJWT, async (req, res) => {
  try {
    const adminEmail = req.tokenEmail;

    // Verify user is admin
    const user = await usersCollection.findOne({ email: adminEmail });

    if (!user || user.role !== "admin") {
      return res.status(403).json({
        success: false,
        message: "Access denied. Admin only.",
      });
    }

    // Get only pending clubs
    const pendingClubs = await clubsCollection
      .find({ status: "pending" })
      .toArray();

    res.json({
      success: true,
      count: pendingClubs.length,
      clubs: pendingClubs,
    });
  } catch (error) {
    console.error("Get pending clubs error:", error);
    res.status(500).json({
      success: false,
      message: "Failed to fetch pending clubs",
    });
  }
});

//* 3. APPROVE a club
app.patch("/admin/clubs/:id/approve", verifyJWT, async (req, res) => {
  try {
    const clubId = req.params.id;
    const adminEmail = req.tokenEmail;

    // Verify user is admin
    const user = await usersCollection.findOne({ email: adminEmail });

    if (!user || user.role !== "admin") {
      return res.status(403).json({
        success: false,
        message: "Access denied. Admin only.",
      });
    }

    // Check if club exists
    const club = await clubsCollection.findOne({ _id: new ObjectId(clubId) });

    if (!club) {
      return res.status(404).json({
        success: false,
        message: "Club not found",
      });
    }

    // Update club status to approved
    const result = await clubsCollection.updateOne(
      { _id: new ObjectId(clubId) },
      {
        $set: {
          status: "approved",
          approvedAt: new Date(),
          approvedBy: adminEmail,
          updatedAt: new Date(),
        },
      }
    );

    console.log(`Club "${club.clubName}" approved by ${adminEmail}`);

    res.json({
      success: true,
      message: `Club "${club.clubName}" has been approved!`,
      club: {
        ...club,
        status: "approved",
      },
    });
  } catch (error) {
    console.error("Approve club error:", error);
    res.status(500).json({
      success: false,
      message: "Failed to approve club",
    });
  }
});

//* 4. REJECT a club
app.patch("/admin/clubs/:id/reject", verifyJWT, async (req, res) => {
  try {
    const clubId = req.params.id;
    const adminEmail = req.tokenEmail;
    const { reason } = req.body; // Optional: rejection reason

    // Verify user is admin
    const user = await usersCollection.findOne({ email: adminEmail });

    if (!user || user.role !== "admin") {
      return res.status(403).json({
        success: false,
        message: "Access denied. Admin only.",
      });
    }

    // Check if club exists
    const club = await clubsCollection.findOne({ _id: new ObjectId(clubId) });

    if (!club) {
      return res.status(404).json({
        success: false,
        message: "Club not found",
      });
    }

    // Update club status to rejected
    const result = await clubsCollection.updateOne(
      { _id: new ObjectId(clubId) },
      {
        $set: {
          status: "rejected",
          rejectedAt: new Date(),
          rejectedBy: adminEmail,
          rejectionReason: reason || "No reason provided",
          updatedAt: new Date(),
        },
      }
    );

    console.log(`Club "${club.clubName}" rejected by ${adminEmail}`);

    res.json({
      success: true,
      message: `Club "${club.clubName}" has been rejected.`,
      club: {
        ...club,
        status: "rejected",
      },
    });
  } catch (error) {
    console.error("Reject club error:", error);
    res.status(500).json({
      success: false,
      message: "Failed to reject club",
    });
  }
});

//* 5. Change club status (general - approve/reject/pending)
app.patch("/admin/clubs/:id/status", verifyJWT, async (req, res) => {
  try {
    const clubId = req.params.id;
    const adminEmail = req.tokenEmail;
    const { status } = req.body; // approved, rejected, pending

    // Verify user is admin
    const user = await usersCollection.findOne({ email: adminEmail });

    if (!user || user.role !== "admin") {
      return res.status(403).json({
        success: false,
        message: "Access denied. Admin only.",
      });
    }

    // Validate status
    if (!["approved", "rejected", "pending"].includes(status)) {
      return res.status(400).json({
        success: false,
        message: "Invalid status. Must be: approved, rejected, or pending",
      });
    }

    // Update club status
    const result = await clubsCollection.updateOne(
      { _id: new ObjectId(clubId) },
      {
        $set: {
          status: status,
          updatedAt: new Date(),
          updatedBy: adminEmail,
        },
      }
    );

    if (result.modifiedCount === 0) {
      return res.status(404).json({
        success: false,
        message: "Club not found or status unchanged",
      });
    }

    res.json({
      success: true,
      message: `Club status changed to "${status}"`,
    });
  } catch (error) {
    console.error("Change status error:", error);
    res.status(500).json({
      success: false,
      message: "Failed to change club status",
    });
  }
});

//!=============ADMIN CLUB APPROVAL END===========!//
```

---

## ðŸ‘” MANAGER - Member Management APIs

```javascript
//!=============MANAGER MEMBER MANAGEMENT START===========!//

//* 1. Get all members of manager's clubs
app.get("/manager/members/:email", verifyJWT, async (req, res) => {
  try {
    const managerEmail = req.params.email;
    const requestEmail = req.tokenEmail;

    // Verify user is accessing their own data
    if (managerEmail !== requestEmail) {
      return res.status(403).json({
        success: false,
        message: "Access denied",
      });
    }

    // Get all memberships where managerEmail matches
    const members = await membershipsCollection
      .find({ managerEmail: managerEmail })
      .toArray();

    console.log(`Found ${members.length} members for manager: ${managerEmail}`);

    res.json({
      success: true,
      count: members.length,
      members: members,
    });
  } catch (error) {
    console.error("Get members error:", error);
    res.status(500).json({
      success: false,
      message: "Failed to fetch members",
    });
  }
});

//* 2. Get members of a SPECIFIC club
app.get("/manager/clubs/:clubId/members", verifyJWT, async (req, res) => {
  try {
    const clubId = req.params.clubId;
    const managerEmail = req.tokenEmail;

    // Verify club belongs to this manager
    const club = await clubsCollection.findOne({ _id: new ObjectId(clubId) });

    if (!club) {
      return res.status(404).json({
        success: false,
        message: "Club not found",
      });
    }

    if (club.managerEmail !== managerEmail) {
      return res.status(403).json({
        success: false,
        message: "You can only view members of your own clubs",
      });
    }

    // Get members of this club
    const members = await membershipsCollection
      .find({ clubId: clubId })
      .toArray();

    console.log(`Found ${members.length} members in club: ${club.clubName}`);

    res.json({
      success: true,
      count: members.length,
      clubName: club.clubName,
      members: members,
    });
  } catch (error) {
    console.error("Get club members error:", error);
    res.status(500).json({
      success: false,
      message: "Failed to fetch club members",
    });
  }
});

//* 3. Change member status (active/expired)
app.patch(
  "/manager/members/:membershipId/status",
  verifyJWT,
  async (req, res) => {
    try {
      const membershipId = req.params.membershipId;
      const managerEmail = req.tokenEmail;
      const { status } = req.body; // active or expired

      // Validate status
      if (!["active", "expired"].includes(status)) {
        return res.status(400).json({
          success: false,
          message: "Invalid status. Must be: active or expired",
        });
      }

      // Get membership
      const membership = await membershipsCollection.findOne({
        _id: new ObjectId(membershipId),
      });

      if (!membership) {
        return res.status(404).json({
          success: false,
          message: "Membership not found",
        });
      }

      // Verify this membership belongs to manager's club
      if (membership.managerEmail !== managerEmail) {
        return res.status(403).json({
          success: false,
          message: "You can only manage members of your own clubs",
        });
      }

      // Update status
      const result = await membershipsCollection.updateOne(
        { _id: new ObjectId(membershipId) },
        {
          $set: {
            status: status,
            updatedAt: new Date(),
          },
        }
      );

      console.log(`Membership ${membershipId} status changed to: ${status}`);

      res.json({
        success: true,
        message: `Member status changed to "${status}"`,
        membership: {
          ...membership,
          status: status,
        },
      });
    } catch (error) {
      console.error("Change member status error:", error);
      res.status(500).json({
        success: false,
        message: "Failed to change member status",
      });
    }
  }
);

//* 4. Set membership expiry date
app.patch(
  "/manager/members/:membershipId/expiry",
  verifyJWT,
  async (req, res) => {
    try {
      const membershipId = req.params.membershipId;
      const managerEmail = req.tokenEmail;
      const { expiryDate } = req.body; // Date string: "2024-12-31"

      // Validate expiry date
      if (!expiryDate) {
        return res.status(400).json({
          success: false,
          message: "Expiry date is required",
        });
      }

      const expiry = new Date(expiryDate);

      if (isNaN(expiry.getTime())) {
        return res.status(400).json({
          success: false,
          message: "Invalid date format",
        });
      }

      // Get membership
      const membership = await membershipsCollection.findOne({
        _id: new ObjectId(membershipId),
      });

      if (!membership) {
        return res.status(404).json({
          success: false,
          message: "Membership not found",
        });
      }

      // Verify ownership
      if (membership.managerEmail !== managerEmail) {
        return res.status(403).json({
          success: false,
          message: "You can only manage members of your own clubs",
        });
      }

      // Determine if membership should be active or expired
      const now = new Date();
      const newStatus = expiry > now ? "active" : "expired";

      // Update expiry date and status
      const result = await membershipsCollection.updateOne(
        { _id: new ObjectId(membershipId) },
        {
          $set: {
            expiresAt: expiry,
            status: newStatus,
            updatedAt: new Date(),
          },
        }
      );

      console.log(`Membership ${membershipId} expiry set to: ${expiryDate}`);

      res.json({
        success: true,
        message: `Expiry date set to ${expiryDate}`,
        membership: {
          ...membership,
          expiresAt: expiry,
          status: newStatus,
        },
      });
    } catch (error) {
      console.error("Set expiry error:", error);
      res.status(500).json({
        success: false,
        message: "Failed to set expiry date",
      });
    }
  }
);

//* 5. Remove member from club (delete membership)
app.delete("/manager/members/:membershipId", verifyJWT, async (req, res) => {
  try {
    const membershipId = req.params.membershipId;
    const managerEmail = req.tokenEmail;

    // Get membership
    const membership = await membershipsCollection.findOne({
      _id: new ObjectId(membershipId),
    });

    if (!membership) {
      return res.status(404).json({
        success: false,
        message: "Membership not found",
      });
    }

    // Verify ownership
    if (membership.managerEmail !== managerEmail) {
      return res.status(403).json({
        success: false,
        message: "You can only remove members from your own clubs",
      });
    }

    // Delete membership
    const result = await membershipsCollection.deleteOne({
      _id: new ObjectId(membershipId),
    });

    console.log(`Membership ${membershipId} removed by manager`);

    res.json({
      success: true,
      message: "Member removed from club",
    });
  } catch (error) {
    console.error("Remove member error:", error);
    res.status(500).json({
      success: false,
      message: "Failed to remove member",
    });
  }
});

//!=============MANAGER MEMBER MANAGEMENT END===========!//
```

---

## ðŸŽ¨ PART 2: FRONTEND CODE

### File 1: Admin - Manage Clubs Page

Create: `src/pages/Dashboard/Admin/ManageClubs.jsx`

```jsx
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import axios from "axios";
import toast from "react-hot-toast";
import { useState } from "react";
import LoadingSpinner from "../../../components/Shared/LoadingSpinner";

const ManageClubs = () => {
  const queryClient = useQueryClient();
  const [filter, setFilter] = useState("all"); // all, pending, approved, rejected
  const [selectedClub, setSelectedClub] = useState(null);
  const [showRejectModal, setShowRejectModal] = useState(false);
  const [rejectionReason, setRejectionReason] = useState("");

  // Fetch all clubs
  const { data: clubsData, isLoading } = useQuery({
    queryKey: ["adminClubs"],
    queryFn: async () => {
      const token = localStorage.getItem("token"); // Adjust based on your auth
      const response = await axios.get(
        `${import.meta.env.VITE_API_URL}/admin/clubs`,
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );
      return response.data;
    },
  });

  // Approve club mutation
  const approveMutation = useMutation({
    mutationFn: async (clubId) => {
      const token = localStorage.getItem("token");
      const response = await axios.patch(
        `${import.meta.env.VITE_API_URL}/admin/clubs/${clubId}/approve`,
        {},
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );
      return response.data;
    },
    onSuccess: (data) => {
      toast.success(data.message || "Club approved!");
      queryClient.invalidateQueries(["adminClubs"]);
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || "Failed to approve club");
    },
  });

  // Reject club mutation
  const rejectMutation = useMutation({
    mutationFn: async ({ clubId, reason }) => {
      const token = localStorage.getItem("token");
      const response = await axios.patch(
        `${import.meta.env.VITE_API_URL}/admin/clubs/${clubId}/reject`,
        { reason },
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );
      return response.data;
    },
    onSuccess: (data) => {
      toast.success(data.message || "Club rejected");
      queryClient.invalidateQueries(["adminClubs"]);
      setShowRejectModal(false);
      setRejectionReason("");
      setSelectedClub(null);
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || "Failed to reject club");
    },
  });

  const handleApprove = (clubId) => {
    if (confirm("Are you sure you want to approve this club?")) {
      approveMutation.mutate(clubId);
    }
  };

  const handleRejectClick = (club) => {
    setSelectedClub(club);
    setShowRejectModal(true);
  };

  const handleRejectSubmit = () => {
    if (selectedClub) {
      rejectMutation.mutate({
        clubId: selectedClub._id,
        reason: rejectionReason,
      });
    }
  };

  if (isLoading) return <LoadingSpinner />;

  const clubs = clubsData?.clubs || [];
  const stats = clubsData?.stats || {};

  // Filter clubs
  const filteredClubs = clubs.filter((club) => {
    if (filter === "all") return true;
    return club.status === filter;
  });

  return (
    <div className="p-6">
      <h1 className="text-3xl font-bold mb-6">Manage Clubs</h1>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div className="stat bg-base-200 rounded-lg shadow">
          <div className="stat-title">Total Clubs</div>
          <div className="stat-value">{clubsData?.total || 0}</div>
        </div>
        <div className="stat bg-warning bg-opacity-20 rounded-lg shadow">
          <div className="stat-title">Pending</div>
          <div className="stat-value text-warning">{stats.pending || 0}</div>
        </div>
        <div className="stat bg-success bg-opacity-20 rounded-lg shadow">
          <div className="stat-title">Approved</div>
          <div className="stat-value text-success">{stats.approved || 0}</div>
        </div>
        <div className="stat bg-error bg-opacity-20 rounded-lg shadow">
          <div className="stat-title">Rejected</div>
          <div className="stat-value text-error">{stats.rejected || 0}</div>
        </div>
      </div>

      {/* Filter Tabs */}
      <div className="tabs tabs-boxed mb-6">
        <a
          className={`tab ${filter === "all" ? "tab-active" : ""}`}
          onClick={() => setFilter("all")}
        >
          All ({clubs.length})
        </a>
        <a
          className={`tab ${filter === "pending" ? "tab-active" : ""}`}
          onClick={() => setFilter("pending")}
        >
          Pending ({stats.pending || 0})
        </a>
        <a
          className={`tab ${filter === "approved" ? "tab-active" : ""}`}
          onClick={() => setFilter("approved")}
        >
          Approved ({stats.approved || 0})
        </a>
        <a
          className={`tab ${filter === "rejected" ? "tab-active" : ""}`}
          onClick={() => setFilter("rejected")}
        >
          Rejected ({stats.rejected || 0})
        </a>
      </div>

      {/* Clubs Table */}
      <div className="overflow-x-auto">
        <table className="table table-zebra w-full">
          <thead>
            <tr>
              <th>Club Name</th>
              <th>Manager</th>
              <th>Category</th>
              <th>Fee</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {filteredClubs.length === 0 ? (
              <tr>
                <td colSpan="7" className="text-center py-8">
                  No clubs found
                </td>
              </tr>
            ) : (
              filteredClubs.map((club) => (
                <tr key={club._id}>
                  <td>
                    <div className="font-semibold">{club.clubName}</div>
                    <div className="text-sm text-gray-500">{club.location}</div>
                  </td>
                  <td>{club.managerEmail}</td>
                  <td>
                    <span className="badge badge-primary">{club.category}</span>
                  </td>
                  <td>
                    {club.membershipFee === 0
                      ? "Free"
                      : `$${club.membershipFee}`}
                  </td>
                  <td>
                    {club.status === "pending" && (
                      <span className="badge badge-warning">Pending</span>
                    )}
                    {club.status === "approved" && (
                      <span className="badge badge-success">Approved</span>
                    )}
                    {club.status === "rejected" && (
                      <span className="badge badge-error">Rejected</span>
                    )}
                  </td>
                  <td>{new Date(club.createdAt).toLocaleDateString()}</td>
                  <td>
                    <div className="flex gap-2">
                      {club.status === "pending" && (
                        <>
                          <button
                            onClick={() => handleApprove(club._id)}
                            className="btn btn-success btn-sm"
                            disabled={approveMutation.isPending}
                          >
                            Approve
                          </button>
                          <button
                            onClick={() => handleRejectClick(club)}
                            className="btn btn-error btn-sm"
                            disabled={rejectMutation.isPending}
                          >
                            Reject
                          </button>
                        </>
                      )}
                      {club.status === "approved" && (
                        <button
                          onClick={() => handleRejectClick(club)}
                          className="btn btn-warning btn-sm"
                        >
                          Revoke
                        </button>
                      )}
                      {club.status === "rejected" && (
                        <button
                          onClick={() => handleApprove(club._id)}
                          className="btn btn-info btn-sm"
                        >
                          Re-approve
                        </button>
                      )}
                    </div>
                  </td>
                </tr>
              ))
            )}
          </tbody>
        </table>
      </div>

      {/* Reject Modal */}
      {showRejectModal && (
        <div className="modal modal-open">
          <div className="modal-box">
            <h3 className="font-bold text-lg">Reject Club</h3>
            <p className="py-4">
              Are you sure you want to reject "{selectedClub?.clubName}"?
            </p>

            <div className="form-control">
              <label className="label">
                <span className="label-text">
                  Reason for rejection (optional)
                </span>
              </label>
              <textarea
                className="textarea textarea-bordered h-24"
                placeholder="Enter reason..."
                value={rejectionReason}
                onChange={(e) => setRejectionReason(e.target.value)}
              ></textarea>
            </div>

            <div className="modal-action">
              <button
                onClick={() => {
                  setShowRejectModal(false);
                  setRejectionReason("");
                  setSelectedClub(null);
                }}
                className="btn btn-ghost"
              >
                Cancel
              </button>
              <button
                onClick={handleRejectSubmit}
                className="btn btn-error"
                disabled={rejectMutation.isPending}
              >
                {rejectMutation.isPending ? "Rejecting..." : "Reject Club"}
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default ManageClubs;
```

---

### File 2: Manager - Manage Members Page

Create: `src/pages/Dashboard/Manager/ManageMembers.jsx`

```jsx
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import axios from "axios";
import toast from "react-hot-toast";
import { useState } from "react";
import useAuth from "../../../hooks/useAuth";
import LoadingSpinner from "../../../components/Shared/LoadingSpinner";

const ManageMembers = () => {
  const { user } = useAuth();
  const queryClient = useQueryClient();
  const [selectedMembership, setSelectedMembership] = useState(null);
  const [showExpiryModal, setShowExpiryModal] = useState(false);
  const [expiryDate, setExpiryDate] = useState("");

  // Fetch all members of manager's clubs
  const { data: members = [], isLoading } = useQuery({
    queryKey: ["managerMembers", user?.email],
    queryFn: async () => {
      const token = localStorage.getItem("token");
      const response = await axios.get(
        `${import.meta.env.VITE_API_URL}/manager/members/${user.email}`,
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );
      return response.data.members;
    },
    enabled: !!user?.email,
  });

  // Change status mutation
  const changeStatusMutation = useMutation({
    mutationFn: async ({ membershipId, status }) => {
      const token = localStorage.getItem("token");
      const response = await axios.patch(
        `${import.meta.env.VITE_API_URL}/manager/members/${membershipId}/status`,
        { status },
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );
      return response.data;
    },
    onSuccess: (data) => {
      toast.success(data.message);
      queryClient.invalidateQueries(["managerMembers"]);
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || "Failed to change status");
    },
  });

  // Set expiry mutation
  const setExpiryMutation = useMutation({
    mutationFn: async ({ membershipId, expiryDate }) => {
      const token = localStorage.getItem("token");
      const response = await axios.patch(
        `${import.meta.env.VITE_API_URL}/manager/members/${membershipId}/expiry`,
        { expiryDate },
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );
      return response.data;
    },
    onSuccess: (data) => {
      toast.success(data.message);
      queryClient.invalidateQueries(["managerMembers"]);
      setShowExpiryModal(false);
      setExpiryDate("");
      setSelectedMembership(null);
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || "Failed to set expiry");
    },
  });

  // Remove member mutation
  const removeMemberMutation = useMutation({
    mutationFn: async (membershipId) => {
      const token = localStorage.getItem("token");
      const response = await axios.delete(
        `${import.meta.env.VITE_API_URL}/manager/members/${membershipId}`,
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );
      return response.data;
    },
    onSuccess: (data) => {
      toast.success(data.message);
      queryClient.invalidateQueries(["managerMembers"]);
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || "Failed to remove member");
    },
  });

  const handleStatusChange
```
